pte2
debug(pte2)
sp <- reset.sim()
data <- gen_ife_data(sp)
devtools::load_all(.)
devtools::load_all()
sp <- reset.sim()
data <- gen_ife_data(sp)
library(tidyr)
library(pte)
library(BMisc)
library(dplyr)
sp <- reset.sim()
data <- gen_ife_data(sp)
res1 <- staggered_ife2(yname="Y",
gname="G",
tname="period",
idname="id",
data=data,
nife=1)
res1
summary(res1)
tstat <- res1$overall_att$overall.att / res1$overall_att$overall.se
tstat
qnorm(.975)
sp$nife_actual
devtools::test()
devtools::test()
devtools::test()
menu(c(1,4), title="how many clusters would you like to use for the inference tests?")
cl <- menu(c(1,4), title="how many clusters would you like to use for the inference tests?")
cl
cl <- menu(c(1,4), title="how many clusters would you like to use for the inference tests?")
readline("how many clusters would like to use for the inference tests?")
cl <- readline("how many clusters would like to use for the inference tests?
Choice: ")
cl <- readline("how many clusters would like to use for the inference tests?  ")
cl
class(cl)
devtools::test()
devtools::check()
devtools::test()
cl
cl=4
cl
sp <- reset.sim()
data <- gen_ife_data(sp)
mc_sims <- 100
rejs <- pblapply(1:mc_sims, function(mc) {
sp <- reset.sim()
data <- gen_ife_data(sp)
res1 <- staggered_ife2(yname="Y",
gname="G",
tname="period",
idname="id",
data=data,
nife=1)
tstat <- res1$overall_att$overall.att / res1$overall_att$overall.se
rej <- 1*( abs(tstat) > qnorm(.975))
rej
}, cl=cl)
mean(unlist(rejs))
sp <- reset.sim()
data <- gen_ife_data(sp)
res1 <- staggered_ife2(yname="Y",
gname="G",
tname="period",
idname="id",
data=data,
nife=1)
tstat <- res1$overall_att$overall.att / res1$overall_att$overall.se
tstat <- res1$att_gt$att / res1$att_gt$se
rej <- 1*( abs(tstat) > qnorm(.975))
rej
summary(res1)
res1$att_gt
sp <- reset.sim()
data <- gen_ife_data(sp)
res1 <- staggered_ife2(yname="Y",
gname="G",
tname="period",
idname="id",
data=data,
nife=1)
tstat <- res1$overall_att$overall.att / res1$overall_att$overall.se
tstat <- res1$att_gt$att[5] / res1$att_gt$se[5]
rej <- 1*( abs(tstat) > qnorm(.975))
rej
mc_sims <- 100
rejs <- pblapply(1:mc_sims, function(mc) {
sp <- reset.sim()
data <- gen_ife_data(sp)
res1 <- staggered_ife2(yname="Y",
gname="G",
tname="period",
idname="id",
data=data,
nife=1)
tstat <- res1$overall_att$overall.att / res1$overall_att$overall.se
tstat <- res1$att_gt$att[5] / res1$att_gt$se[5]
rej <- 1*( abs(tstat) > qnorm(.975))
rej
}, cl=cl)
rejs <- pblapply(1:mc_sims, function(mc) {
sp <- reset.sim()
data <- gen_ife_data(sp)
res1 <- staggered_ife2(yname="Y",
gname="G",
tname="period",
idname="id",
data=data,
nife=1)
tstat_overall <- res1$overall_att$overall.att / res1$overall_att$overall.se
tstat_attgt <- res1$att_gt$att[5] / res1$att_gt$se[5]
tstat_dyn <- res1$event_study$att.egt[4] / res1$event_study$se.egt[4]
rej_overall <- 1*( abs(tstat_overall) > qnorm(.975))
rej_attgt <- 1*( abs(tstat_attgt) > qnorm(.975))
rej_dyn <- 1*( abs(tstat_dyn) > qnorm(.975))
list(rej_overall=rej_overall, rej_attgt=rej_attgt, rej_dyn=rej_dyn)
}, cl=cl)
rej_overall_frac <- mean(unlist(BMisc::getListElement(rejs, "rej_overall")))
rej_overall_frac
rej_attgt_frac <- mean(unlist(BMisc::getListElement(rejs, "rej_attgt")))
rej_dyn_frac <- mean(unlist(BMisc::getListElement(rejs, "rej_dyn")))
rej_dyn_frac
rej_attgt_frac
devtools::test()
devtools::test()
?expect_equal
.01/.06
?expect_equal
.07-.06
devtools::test()
sp <- reset.sim()
sp$nife_actual
sp <- reset.sim()
sp$nife_actual <- -1
data <- gen_ife_data(sp)
res <- staggered_ife2(yname="Y",
gname="G",
tname="period",
idname="id",
data=data,
nife=-1)
tstat_overall <- res$overall_att$overall.att / res$overall_att$overall.se
tstat_attgt <- res$att_gt$att[5] / res$att_gt$se[5]
tstat_dyn <- res$event_study$att.egt[4] / res$event_study$se.egt[4]
rej_overall <- 1*( abs(tstat_overall) > qnorm(.975))
rej_attgt <- 1*( abs(tstat_attgt) > qnorm(.975))
rej_dyn <- 1*( abs(tstat_dyn) > qnorm(.975))
rej_dyn
cl
cl=5
cl=10
#------------------------------------------------------------------------
#  levels
#------------------------------------------------------------------------
rejs <- pblapply(1:mc_sims, function(mc) {
sp <- reset.sim()
sp$nife_actual <- -1
data <- gen_ife_data(sp)
res <- staggered_ife2(yname="Y",
gname="G",
tname="period",
idname="id",
data=data,
nife=-1)
tstat_overall <- res$overall_att$overall.att / res$overall_att$overall.se
tstat_attgt <- res$att_gt$att[5] / res$att_gt$se[5]
tstat_dyn <- res$event_study$att.egt[4] / res$event_study$se.egt[4]
rej_overall <- 1*( abs(tstat_overall) > qnorm(.975))
rej_attgt <- 1*( abs(tstat_attgt) > qnorm(.975))
rej_dyn <- 1*( abs(tstat_dyn) > qnorm(.975))
list(rej_overall=rej_overall, rej_attgt=rej_attgt, rej_dyn=rej_dyn)
}, cl=cl)
rej_overall_frac <- mean(unlist(BMisc::getListElement(rejs, "rej_overall")))
rej_attgt_frac <- mean(unlist(BMisc::getListElement(rejs, "rej_attgt")))
rej_dyn_frac <- mean(unlist(BMisc::getListElement(rejs, "rej_dyn")))
expect_equal(rej_overall_frac, 0.06, tolerance=.05) # make test fail if reject 0
expect_equal(rej_attgt_frac, 0.06, tolerance=.05)
expect_equal(rej_dyn_frac, 0.06, tolerance=.05)
#------------------------------------------------------------------------
#  0 ife
#------------------------------------------------------------------------
rejs <- pblapply(1:mc_sims, function(mc) {
sp <- reset.sim()
sp$nife_actual <- 0
data <- gen_ife_data(sp)
res <- staggered_ife2(yname="Y",
gname="G",
tname="period",
idname="id",
data=data,
nife=0)
tstat_overall <- res$overall_att$overall.att / res$overall_att$overall.se
tstat_attgt <- res$att_gt$att[5] / res$att_gt$se[5]
tstat_dyn <- res$event_study$att.egt[4] / res$event_study$se.egt[4]
rej_overall <- 1*( abs(tstat_overall) > qnorm(.975))
rej_attgt <- 1*( abs(tstat_attgt) > qnorm(.975))
rej_dyn <- 1*( abs(tstat_dyn) > qnorm(.975))
list(rej_overall=rej_overall, rej_attgt=rej_attgt, rej_dyn=rej_dyn)
}, cl=cl)
rej_overall_frac <- mean(unlist(BMisc::getListElement(rejs, "rej_overall")))
rej_attgt_frac <- mean(unlist(BMisc::getListElement(rejs, "rej_attgt")))
rej_dyn_frac <- mean(unlist(BMisc::getListElement(rejs, "rej_dyn")))
expect_equal(rej_overall_frac, 0.06, tolerance=.05) # make test fail if reject 0
expect_equal(rej_attgt_frac, 0.06, tolerance=.05)
expect_equal(rej_dyn_frac, 0.06, tolerance=.05)
#------------------------------------------------------------------------
#  1 ife
#------------------------------------------------------------------------
rejs <- pblapply(1:mc_sims, function(mc) {
sp <- reset.sim()
data <- gen_ife_data(sp)
res <- staggered_ife2(yname="Y",
gname="G",
tname="period",
idname="id",
data=data,
nife=1)
tstat_overall <- res$overall_att$overall.att / res$overall_att$overall.se
tstat_attgt <- res$att_gt$att[5] / res$att_gt$se[5]
tstat_dyn <- res$event_study$att.egt[4] / res$event_study$se.egt[4]
rej_overall <- 1*( abs(tstat_overall) > qnorm(.975))
rej_attgt <- 1*( abs(tstat_attgt) > qnorm(.975))
rej_dyn <- 1*( abs(tstat_dyn) > qnorm(.975))
list(rej_overall=rej_overall, rej_attgt=rej_attgt, rej_dyn=rej_dyn)
}, cl=cl)
rej_overall_frac <- mean(unlist(BMisc::getListElement(rejs, "rej_overall")))
rej_attgt_frac <- mean(unlist(BMisc::getListElement(rejs, "rej_attgt")))
rej_dyn_frac <- mean(unlist(BMisc::getListElement(rejs, "rej_dyn")))
expect_equal(rej_overall_frac, 0.06, tolerance=.05) # make test fail if reject 0
expect_equal(rej_attgt_frac, 0.06, tolerance=.05)
expect_equal(rej_dyn_frac, 0.06, tolerance=.05)
rejs <- pblapply(1:mc_sims, function(mc) {
sp <- reset.sim()
sp$nife_actual <- 2
data <- gen_ife_data(sp)
res <- staggered_ife2(yname="Y",
gname="G",
tname="period",
idname="id",
data=data,
nife=2)
tstat_overall <- res$overall_att$overall.att / res$overall_att$overall.se
tstat_attgt <- res$att_gt$att[5] / res$att_gt$se[5]
tstat_dyn <- res$event_study$att.egt[4] / res$event_study$se.egt[4]
rej_overall <- 1*( abs(tstat_overall) > qnorm(.975))
rej_attgt <- 1*( abs(tstat_attgt) > qnorm(.975))
rej_dyn <- 1*( abs(tstat_dyn) > qnorm(.975))
list(rej_overall=rej_overall, rej_attgt=rej_attgt, rej_dyn=rej_dyn)
}, cl=cl)
rej_overall_frac <- mean(unlist(BMisc::getListElement(rejs, "rej_overall")))
rej_attgt_frac <- mean(unlist(BMisc::getListElement(rejs, "rej_attgt")))
rej_dyn_frac <- mean(unlist(BMisc::getListElement(rejs, "rej_dyn")))
expect_equal(rej_overall_frac, 0.06, tolerance=.05) # make test fail if reject 0
expect_equal(rej_attgt_frac, 0.06, tolerance=.05)
expect_equal(rej_dyn_frac, 0.06, tolerance=.05)
waldo::compare(0.6, 0.5)
waldo::compare(0.6, 0.5, tolerance=.5)
waldo::compare(0.06, 0.05, tolerance=.05)
rej_overall_frac
wald::compare(0.05, 0.06, tolerance=.05)
waldo::compare(0.05, 0.06, tolerance=.05)
waldo::compare(0.06, 0.05, tolerance=.05)
waldo::compare()
waldo::compare
?waldo::compare
all.equal(0.06, 0.05, tol=.05)
.06-.05
/.05
.01/.05
.01/.06
.11/.06
(.11-.06)/.06
devtools::test()
devtools::test()
# load packages
library(did) # devtools::install_github("bcallaway11/did")
library(BMisc) # devtools::install_github("bcallaway11/BMisc")
library(twfeweights) # devtools::install_github("bcallaway11/twfeweights")
library(HonestDid) # devtools::install_github("asheshrambachan/HonestDID")
library(fixest) # install.packages("fixest")
library(modelsummary) # install.packages("model.summary")
library(ggplot2) # install.packages("ggplot2")
# load data
load(url("https://github.com/bcallaway11/did_chapter/raw/master/mw_data_ch2.RData"))
# setup data
# drops NE region and a couple of small groups
mw_data_ch2 <- subset(mw_data_ch2, (G %in% c(2004,2006,2007,0)) & (region != "1"))
head(mw_data_ch2[,c("id","year","G","lemp","lpop","region")])
# drop 2007 as these are right before fed. minimum wage change
# data2 <- subset(mw_data_ch2, G!=2007 & year >= 2003)
# keep 2007 => larger sample size
data3 <- subset(mw_data_ch2, year >= 2001)
data3$cohort <- data3$G
devtools::load_all("~/Dropbox/pte")
devtools::load_all("~/Dropbox/ife")
library(tidyr)
library(dplyr)
cs_res <- att_gt(yname="lemp",
gname="cohort",
tname="year",
idname="countyreal",
data=data3)
summary(cs_res)
ggdid(cs_res)
dyn_res <- aggte(cs_res, type="dynamic")
ggdid(dyn_res)
pte_did <- pte(yname="lemp",
gname="cohort",
tname="year",
idname="countyreal",
data=data3,
setup_pte_fun=setup_pte,
subset_fun=two_by_two_subset,
attgt_fun=did_attgt,
xformla=~1)
summary(pte_did)
ggpte(pte_did)
ife1 <- staggered_ife2(yname="lemp",
gname="cohort",
tname="year",
idname="countyreal",
data=data3,
nife=1,
#weighting_matrix="2sls",
boot_type="empirical",
biters=100,
cl=10)
summary(ife1)
ife0 <- staggered_ife2(yname="lemp",
gname="cohort",
tname="year",
idname="countyreal",
data=data3,
nife=0,
boot_type="empirical",
biters=100,
cl=10)
summary(ife0)
ggpte(ife0)
ife1$attgt_results
ife1 <- staggered_ife2(yname="lemp",
gname="cohort",
tname="year",
idname="countyreal",
data=data3,
nife=1,
weighting_matrix="2sls",
boot_type="empirical",
biters=100,
cl=10)
summary(ife1)
ggdid(ife1$att_gt)
ife1$attgt_results
ggdid(ife1$attgt_results)
ggdid(cs_res)
plot_df <- ife1$attgt_results
plot_df <- subset(plot_df, time.period < 2006)
plot_df$post <- as.factor(1*(plot_df$time.period >= plot_df$group))
ggplot(plot_df, aes(x=time.periods, y=att, color=post))
ggplot(plot_df, aes(x=time.period, y=att, color=post))
ggplot(plot_df, aes(x=time.period, y=att, color=post)) +
geom_line()
ggplot(plot_df, aes(x=time.period, y=att, color=post)) +
geom_line() +
facet_wrap(~ group)
ggplot(plot_df, aes(x=time.period, y=att, color=post)) +
geom_line() +
facet_wrap(~ group, ncol=1)
ggplot(plot_df, aes(x=time.period, y=att, color=post)) +
geom_line() +
facet_grid(~ group, ncol=1) +
ife1$att_gt
ggplot(plot_df, aes(x=time.period, y=att, color=post)) +
geom_line() +
facet_grid(~ group) +
ife1$att_gt
ggplot(plot_df, aes(x=time.period, y=att, color=post)) +
geom_line() +
geom_point()
ggplot(plot_df, aes(x=time.period, y=att, color=post)) +
geom_line() +
geom_point() +
facet_wrap(~ group, ncol=1) +
ife1$att_gt
ggplot(plot_df, aes(x=time.period, y=att, color=post)) +
geom_line() +
geom_point() +
facet_wrap(~ group, ncol=1) +
theme_bw()
ggplot(plot_df, aes(x=time.period, y=att, color=post)) +
geom_line(size=1.2) +
geom_point(size=1.5) +
facet_wrap(~ group, ncol=1) +
theme_bw()
ggplot(plot_df, aes(x=time.period, y=att, color=post)) +
geom_line(size=1.2) +
geom_point(size=2) +
facet_wrap(~ group, ncol=1) +
theme_bw()
ggplot(plot_df, aes(x=time.period, y=att, color=post)) +
geom_line(size=1.2) +
geom_point(size=2) +
facet_wrap(~ group, ncol=1) +
theme_bw() +
scale_x_discrete()
ggplot(plot_df, aes(x=time.period, y=att, color=post)) +
geom_line(size=1.2) +
geom_point(size=2) +
facet_wrap(~ group, ncol=1) +
theme_bw() +
scale_x_discrete() +
xlim(c(2003,2006))
ggplot(plot_df, aes(x=time.period, y=att, color=post)) +
geom_line(size=1.2) +
geom_point(size=2) +
facet_wrap(~ group, ncol=1) +
theme_bw() +
xlim(c(2003,2006))
ggplot(plot_df, aes(x=time.period, y=att, color=post)) +
geom_line(size=1.2) +
geom_point(size=2) +
facet_wrap(~ group, ncol=1) +
theme_bw() +
xlim(c(2003,2005))
ggplot(plot_df, aes(x=time.period, y=att, color=post)) +
geom_line(size=1.2) +
geom_point(size=2) +
geom_line(aes(y=att+1.96*se), linetype="dashed")
ggplot(plot_df, aes(x=time.period, y=att, color=post)) +
geom_line(size=1.2) +
geom_point(size=2) +
geom_line(aes(y=att+1.96*se), linetype="dashed") +
facet_wrap(~ group, ncol=1) +
theme_bw() +
xlim(c(2003,2005))
ggplot(plot_df, aes(x=time.period, y=att, color=post)) +
geom_line(size=1.2) +
geom_point(size=2) +
geom_line(aes(y=att+1.96*se), linetype="dashed", color="black") +
facet_wrap(~ group, ncol=1) +
theme_bw() +
xlim(c(2003,2005))
plot_df$se
ggplot(plot_df, aes(x=time.period, y=att, color=post)) +
geom_line(size=1.2) +
geom_point(size=2) +
geom_line(aes(y=att+1.96*se), linetype="dashed", color="black") +
geom_line(aes(y=att-1.96*se), linetype="dashed", color="black")
ggplot(plot_df, aes(x=time.period, y=att, color=post)) +
geom_line(size=1.2) +
geom_point(size=2) +
geom_line(aes(y=att+1.96*se), linetype="dashed", color="black") +
geom_line(aes(y=att-1.96*se), linetype="dashed", color="black") +
facet_wrap(~ group, ncol=1) +
theme_bw() +
xlim(c(2003,2005))
# won't compute...
ife2 <- staggered_ife2(yname="lemp",
gname="cohort",
tname="year",
idname="countyreal",
data=data3,
nife=2,
boot_type="empirical",
cl=10)
summary(ife2)
ife1 <- staggered_ife2(yname="lemp",
gname="cohort",
tname="year",
idname="countyreal",
data=data3,
nife=1,
weighting_matrix="gmm",
boot_type="empirical",
biters=100,
cl=10)
summary(ife1)
ggdid(ife1$attgt_results)
plot_df <- ife1$attgt_results
plot_df
plot_df$post <- as.factor(1*(plot_df$time.period >= plot_df$group))
ggplot(plot_df, aes(x=time.period, y=att, color=post)) +
geom_line(size=1.2) +
geom_point(size=2) +
geom_line(aes(y=att+1.96*se), linetype="dashed", color="black") +
geom_line(aes(y=att-1.96*se), linetype="dashed", color="black") +
facet_wrap(~ group, ncol=1) +
theme_bw() +
xlim(c(2003,2005))
ggplot(plot_df, aes(x=time.period, y=att, color=post)) +
geom_line(size=1.2) +
geom_point(size=2) +
geom_line(aes(y=att+1.96*se), linetype="dashed", color="black") +
geom_line(aes(y=att-1.96*se), linetype="dashed", color="black") +
facet_wrap(~ group, ncol=1) +
theme_bw() +
xlim(c(2003,2005)) +
ylim(c(-.2,.2))
ggdid(cs_res)
ggplot(plot_df, aes(x=time.period, y=att, color=post)) +
geom_line(size=1.2) +
geom_point(size=2) +
geom_line(aes(y=att+1.96*se), linetype="dashed", color="black") +
geom_line(aes(y=att-1.96*se), linetype="dashed", color="black") +
facet_wrap(~ group, ncol=1) +
theme_bw() +
xlim(c(2003,2005)) +
ylim(c(-.2,.2))
devtools::test()
